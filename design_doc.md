# 具身智能抓取系统设计文档（端到端离散）

## 1. 项目目标与约束
- 任务：轮式移动底盘 + 6DoF 机械臂 + 双指夹爪，进行桌面物体抓取。
- 输入：多路 RGB-D 图像（头部/手上/手臂/腿部相机）。
- 输出：离散动作序列（端到端策略直接给出动作）。
- 约束：闭环控制周期 ≤ 100ms。
- 数据：允许仿真 + 少量真实示范。
- 物体：多品类（不同尺寸、材质、外观）。

## 2. 系统总体架构
模块化分为：感知输入 → 端到端策略 → 动作执行与安全。

- 多相机同步采集 RGB-D
- 端到端策略网络（多相机融合）
- 动作执行器（底盘、机械臂、夹爪）
- 失败检测与回退动作
- 训练/评估/部署工具链

## 3. 传感与输入
### 3.1 相机配置
- 头部相机：全局视角、定位桌面与目标物体。
- 手上相机：近景抓取细节。
- 手臂相机：侧视遮挡补偿。
- 腿部相机：地面/底盘避障与姿态参考。

### 3.2 输入格式
- 每路 RGB-D 输入 4 通道。
- 分辨率：224×224。
- 时序堆叠：最近 3 帧。
- 总通道数：4 路 × 4 通道 × 3 帧 = 48 通道。

## 4. 动作空间设计（精细离散）
### 4.1 底盘与对齐
- `FWD`, `LEFT`, `RIGHT`, `STOP`
- `ALIGN_LEFT`, `ALIGN_RIGHT`, `ALIGN_FORWARD`

### 4.2 机械臂位置与姿态
- 位置：`X+`, `X-`, `Y+`, `Y-`, `Z+`, `Z-`，步长 1.0–1.5 cm
- 姿态：`ROLL+`, `ROLL-`, `PITCH+`, `PITCH-`, `YAW+`, `YAW-`，步长 2–3°

### 4.3 夹爪
- `GRIP_OPEN`, `GRIP_CLOSE`

### 4.4 失败回退
- `BACKOFF`：底盘后退一小步 + 机械臂抬升一小步

### 4.5 动作编码
动作集合大小：
- 底盘/对齐：7
- 机械臂位置：6
- 机械臂姿态：6
- 夹爪：2
- 回退：1
总计：22 个离散动作。

## 5. 端到端策略网络
### 5.1 网络结构
- 每路 RGB-D：独立轻量视觉主干（ResNet18 或 MobileViT-S）。
- 多路特征融合：concat + 1×1 conv + global average pooling。
- 动作头：2 层 MLP → softmax（输出 22 动作概率）。

### 5.2 推理性能目标
- 单次推理 < 30 ms（桌面 GPU）。
- 100 ms 控制周期内余量：传感同步 + 控制执行。

## 6. 训练流程
### 6.1 数据采集
- 仿真：20k–50k 轨迹。
- 真实：500–1000 轨迹。

### 6.2 随机化策略
- 多桌面高度随机化（3 档覆盖：低/中/高）。
- 物体材质、纹理、颜色、光照随机化。
- 视角扰动与遮挡模拟。

### 6.3 训练方法
- 行为克隆（BC）：交叉熵监督动作。
- 真实数据微调：减少 sim2real gap。
- 难例回放与补数据：透明/反光/小物体重点补充。

## 7. 评估与指标
- 抓取成功率（目标 > 85%）。
- 平均步数（越少越好）。
- 对齐失败率 / 误抓率。
- 回退触发率（稳定性指标）。

## 8. 部署与推理
- 导出：PyTorch → ONNX → TensorRT。
- 推理输入：多路 RGB-D 同步，缺帧用上一帧补齐。
- 动作执行：控制频率 10Hz。

## 9. 风险与对策
- 遮挡：手上相机优先权重，回退动作缓解。
- 多桌面高度：Z 步长细化，仿真覆盖高度分布。
- 多品类泛化：强随机化 + 少量真实微调。

## 10. 实施里程碑（建议）
1) 仿真环境搭建与专家策略采集。
2) BC 训练 + 初始部署。
3) 真实数据采集与微调。
4) 失败案例回放 → 数据补充 → 迭代优化。

## 11. 交付清单
- 动作表与编码映射。
- 仿真数据采集脚本与配置。
- 训练代码（BC）。
- 推理部署脚本（ONNX/TensorRT）。
- 评估与可视化工具。


## 12. 动作表文件
- JSON: `actions.json`
- YAML: `actions.yaml`

## 13. 动作表（嵌入）

| ID | 名称 | 组 | 步长 | 单位 |
|---:|---|---|---:|---|
| 0 | FWD | base | 0.000 |  |
| 1 | LEFT | base | 0.000 |  |
| 2 | RIGHT | base | 0.000 |  |
| 3 | STOP | base | 0.000 |  |
| 4 | ALIGN_LEFT | align | 0.000 |  |
| 5 | ALIGN_RIGHT | align | 0.000 |  |
| 6 | ALIGN_FORWARD | align | 0.000 |  |
| 7 | X+ | arm_pos | 0.015 | m |
| 8 | X- | arm_pos | -0.015 | m |
| 9 | Y+ | arm_pos | 0.015 | m |
| 10 | Y- | arm_pos | -0.015 | m |
| 11 | Z+ | arm_pos | 0.015 | m |
| 12 | Z- | arm_pos | -0.015 | m |
| 13 | ROLL+ | arm_rot | 3.000 | deg |
| 14 | ROLL- | arm_rot | -3.000 | deg |
| 15 | PITCH+ | arm_rot | 3.000 | deg |
| 16 | PITCH- | arm_rot | -3.000 | deg |
| 17 | YAW+ | arm_rot | 3.000 | deg |
| 18 | YAW- | arm_rot | -3.000 | deg |
| 19 | GRIP_OPEN | gripper | 0.000 |  |
| 20 | GRIP_CLOSE | gripper | 0.000 |  |
| 21 | BACKOFF | recovery | 0.000 |  |
